<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css"> -->
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <title>
        <%= beer.name %>
    </title>
</head>

<body>
    <%- include('../partials/_navbar') %>

        <h1>
            <%= beer.name %>
        </h1>
        <h2>
            <%= beer.style %>
        </h2>
        <div class="beer-stats">
            <h5>ABV: <%= beer.abv %>%</h5>
            <h5>IBU: <%= beer.ibu %>
            </h5>
        </div>
        <h5>FLAVOR PROFILE:</h5>
        <p>
            <%= beer.flavorProfile %>
        </p>
        <div class="botanicals">
            <h5>MALT: <%= beer.malt %>
            </h5>
            <h5>HOPS: <%= beer.hops %>
            </h5>
        </div>
        <h5>FOOD PAIRING NOTES:</h5>
        <p>
            <%= beer.foodPairing %>
        </p>

        <h5>AVAILABILITY:</h5>
        <p>
            <%= beer.availability %>
        </p>
        <% if (user && user.role==='admin' ) { %>
            <h5>BREWED BY:</h5>
            <%= beer.createdBy.username %>
                </p>
                <% } %>
                    <br>
                    <div class="edit-delete">
                        <% if (user && user.role==='admin' ) { %>
                            <form action="/beers/<%= beer._id %>/edit" method="GET">
                                <button type="submit">Edit Beer</button>
                            </form>
                            <br>
                            <form action="/beers/<%= beer._id %>?_method=DELETE" method="POST">
                                <button type="submit"
                                    onclick="return confirm('Are you sure you want to delete this beer?')">Delete
                                    <%= beer.name %>
                                </button>
                            </form>
                            <% } %>
                    </div>
                    <div class="user-input">
                        <h3>Comments</h3>
                        <% if (user) { %>
                            <h4>Add a Comment</h4>
                            <form action="/beers/<%= beer._id %>/comments" method="POST">
                                <textarea name="comment" placeholder="How's the beer..."></textarea>
                                <button type="submit">Submit Comment</button>
                            </form>
                            <% } else { %>
                                <p><a href="/auth/sign-in">Sign In</a> to leave a comment!</p>
                                <% } %>
                    </div>

                    <div class="display-comments">
                        <% if (comments.length> 0) { %>
                            <% comments.forEach(comment=> { %>
                                <h5>
                                    <%= comment.commentBy.username %>
                                </h5>
                                <p class="comment-text">
                                    <%= comment.comment %>
                                </p>
                                <% if (user && (user._id.toString()===comment.commentBy._id.toString() ||
                                    user.role==='admin' )) { %>
                                    <form action="/beers/<%= beer._id %>/comments/<%= comment._id %>?_method=DELETE"
                                        method="POST">
                                        <button type="submit"
                                            onclick="return confirm('Are you sure you want to delete this comment?')"
                                            class="delete-button">Delete</button>
                                    </form>
                                    <% } %>
                                        <% }); %>
                                            <% } else { %>
                                                <p>No comments yet. Be the first to comment on this beer!</p>
                                                <% } %>
                    </div>

</body>

</html>